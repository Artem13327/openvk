<center>
    <img src="/assets/packages/static/openvk/img/oof.apng" alt="Пользователь заблокирован." style="width: 20%;" />
    <p>
        {tr("user_banned", htmlentities($user->getFirstName()))|noescape}<br/>
        {_"user_banned_comment"} <b>{$user->getBanReason()}</b>.
    </p>
    <p n:if="isset($thisUser) && $thisUser->getChandlerUser()->can('access')->model('admin')->whichBelongsTo(NULL)">
        <br/><a href="javascript:toggleUnbanUser()" class="button">{_unban_user_action}</a>
    </p>
</center>

<script n:if="isset($thisUser) && $thisUser->getChandlerUser()->can('access')->model('admin')->whichBelongsTo(NULL)">
    function toggleUnbanUser() {
        uUnbanMsgTxt  = "Вы собираетесь разбанить пользователя " + {$user->getCanonicalName()} + ".";
        uUnbanMsgTxt += "<br/>Сейчас он заблокирован по причине: <strong>" + {$user->getBanReason()} + "</strong>.";
        
        MessageBox("Разбанить " + {$user->getFirstName()}, uUnbanMsgTxt, ["Подтвердить", "Отмена"], [
            (function() {
                xhr = new XMLHttpRequest();
                xhr.open("GET", "/admin/unban/" + {$user->getId()} + "?hash=" + {rawurlencode($csrfToken)}, true);
                xhr.onload = (function() {
                    if(xhr.responseText.indexOf("success") === -1)
                        MessageBox("Ошибка", "Не удалось разблокировать пользователя...", ["OK"], [Function.noop]);
                    else
                        MessageBox("Операция успешна", "Пользователь разблокирован", ["OK"], [Function.noop]);
                });
                xhr.send(null);
            }),
            Function.noop
        ]);
    }
</script>
